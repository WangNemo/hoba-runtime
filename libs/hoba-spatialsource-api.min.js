HOBA=window.HOBA||{},HOBA.init=function(t,e){return AudioContext=window.AudioContext||window.webkitAudioContext,HOBA.audioContext=e||new AudioContext,HOBA._panner=HOBA.createSpatialPanner(),HOBA.loadHRTF(t)},HOBA.createSpatialPanner=function(){var t=new HOBA.SpatialPanner;return HOBA._hrtfURL&&t.setSPosition(0,0,1),t},HOBA.loadHRTF=function(t){return new Promise(function(e,n){HOBA._panner.loadHRTF(t).then(function(n){HOBA._hrtfURL=t;var o=Object.keys(HOBA.sources);o.forEach(function(t){HOBA.sources[t].updateHRTF()}),e(n)},function(){n()})})},HOBA.getElevationRange=function(){return HOBA._panner.elevationRange},HOBA.startOSC=function(t,e){HOBA._oscClient=new HOBA.OSCClient(t,e),HOBA._oscClient.start()},HOBA.stopOSC=function(){HOBA._oscClient.stop()},HOBA.sources={},HOBA.addSource=function(t){HOBA.sources[t.id]=t,t.updateHRTF(),t.connect(HOBA.audioContext.destination)},HOBA.removeSource=function(t){if(t in HOBA.sources){var e=HOBA.sources[t];e.stop(),delete HOBA.sources[t]}},HOBA.getSource=function(t){var e=void 0;if(!isNaN(t))return HOBA.sources[t];var n=t.split("/");return"source"==n[1]&&(e=HOBA.sources[n[2]]),e},HOBA._updateSources=function(){var t=Object.keys(HOBA.sources);t.forEach(function(t){HOBA.sources[t].panner._update("position")})},HOBA.soundpool={},HOBA.addSound=function(t,e,n){return new Promise(function(o,i){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onload=function(){200==r.status?HOBA.audioContext.decodeAudioData(r.response).then(function(i){n=n||1;var r={id:t,url:e,gain:n};r.buffer=i,HOBA.soundpool[t]=r,o()},function(){i()}):i()},r.open("get",e,!0),r.send(null)})},HOBA.removeSound=function(t){delete HOBA.soundpool[t]},HOBA.getSoundpoolID=function(t){var e=void 0;return Object.keys(HOBA.soundpool).some(function(n){var o=HOBA.soundpool[n];return o.url.indexOf(t)>=0?(e=n,!0):void 0}),e},HOBA=window.HOBA||{},HOBA.SpatialSource=function(t,e){function n(){var t=HOBA.audioContext;if(r=t.createGain(),i=s.panner=HOBA.createSpatialPanner(),i.connect(r),e.element){var n=document.getElementById(e.element);o=t.createMediaElementSource(n)}else o=t.createBufferSource(),e.sound&&e.sound in HOBA.soundpool&&(s.sound=e.sound);var a=e.pos?e.pos.a:0,u=e.pos?e.pos.e:0,c=e.pos?e.pos.r:1;s.setSPosition(a,u,c),o.connect(i.input)}this.id=t;var o,i,r,s=this;this.connect=function(t){r.connect(t)},this.disconnect=function(){r.disconnect()},this.start=function(){o.start()},this.stop=function(){o.stop()},this.setSPosition=function(t,e,n){return i.setSPosition(t,e,n,!0)},this.setCPosition=function(t,e,n){i.setCPosition(t,e,n);var o=HOBA.listener.cartesian2spherical(t,e,n);return o.index=i.setSPosition(o.a,o.e,o.r),o},this.updateHRTF=function(){i.updateHRTF()},Object.defineProperty(this,"gain",{get:function(){return r.gain.value},set:function(t){r.gain.value=t}}),Object.defineProperty(this,"sound",{get:function(){return o},set:function(t){o.buffer&&(o.stop(),o.disconnect(),o=HOBA.audioContext.createBufferSource(),o.connect(i.input)),i._srcgain=HOBA.soundpool[t].gain,o.buffer=HOBA.soundpool[t].buffer,o.loop=!0,o.start()}}),e=e||{},n()},HOBA=window.HOBA||{},HOBA.OSCClient=function(t,e){function n(){o=new osc.WebSocketPort({url:t}),o.on("message",function(t){var n=t.address.split("/");if("source"==n[1]){var o=HOBA.getSource(t.address);if(o){switch(n[n.length-1]){case"position":var i,r,s,a;if("c"==t.args[0]){var u=t.args[1],c=t.args[2],h=t.args[3],f=o.setCPosition(u,c,h);i=f.azimuth,r=f.elevation,s=f.r,a=f.index}else i=t.args[1],r=t.args[2],s=t.args[3],a=o.setSPosition(i,r,s,!0);var l={tokens:n,source:o,index:a,azimuth:i,elevation:r,distance:s};break;case"sound":var l={source:o,tokens:n},p=t.args[0];-1==p?(l.action="remove",HOBA.removeSource(o.id)):0==p?(l.action="stop",o.stop()):(l.action="change",l.soundid=p,o.sound=p);break;case"gain":o.gain=t.args[0];var l={source:o,tokens:n}}e(l,t)}else if("sound"==n[n.length-1]){var d={pos:{e:0,a:0},sound:t.args[0]},o=new HOBA.SpatialSource(n[2],d);HOBA.addSource(o);var l={action:"add",tokens:n,source:o,soundid:t.args[0]};e(l,t)}else console.log("unknown source:",t.address)}else if("listener"==n[1]){var l={tokens:n};if("position"==n[2])HOBA.listener.position=t.args;else if("front"==n[2])HOBA.listener.front=t.args;else if("up"==n[2])HOBA.listener.up=t.args;else if("hrtf"==n[2])return void HOBA.loadHRTF(t.args[0]).then(function(n){l.geo=n,e(l,t)});e(l,t)}else if("sound"==n[1]){var g=t.args[0];g?HOBA.addSound(n[2],g,t.args[1]):HOBA.removeSound(n[2]);var l={tokens:n,url:g};e(l,t)}}),o.onopen=function(){console.log("opened")}}var o;n(),this.start=function(){o.open()},this.stop=function(){o.close()}};
//# sourceMappingURL=hoba-spatialsource-api.min.js.map